# 历史失败和经验教训

- **F3EO-raw (理论原点)**:
  - **机制**: `g_eff = g + H·g`，严格要求 `batch_size=1`。
  - **定位**: 最纯粹的理论实现，是当前研究和未来发展的主线。它将高方差的 `H·g` 信号视为**有意义的探索信号**，而非需要消除的噪声。

- **F3EPI (已废弃)**:
  - **机制**: 试图用一个复杂的 `β = tanh(log(PI))` 信号同时调节探索方向和正则化强度。
  - **教训**: **单一控制器无法有效解决相互冲突的多个目标**。该方案已被证伪，其代码和理论均已废弃。

- **F3EWD (已取代)**:
  - **机制**: 将探索 (`H·g`) 与正则化（PI 引导的权重衰减）解耦。
  - **教训**: **解耦是正确的设计方向**。但其实现过于复杂。现代范式是使用 `F3EO-raw` 作为核心，并可选择性地、独立地应用其他正则化技术（如 PIWD），而非将其捆绑在优化器内部。

## PIWD: 预测完整性引导的权重衰减 (Predictive-Integrity-Guided Weight Decay)

PIWD 是一种从 F3EWD 中剥离出的“预测完整性”驱动自适应权重衰减机制：用 `PI=exp(−(H+γ‖g‖))` 实时度量模型自信度，再通过 `effective_gamma=−log(1−PI+ε)` 把 PI 映射为指数级增长的衰减系数；当 PI→1 时正则化趋于无穷，强制模型回归 MDL 解，PI→0 时退回基线，不妨碍学习。实现仅需三行代码，零额外超参。实验规范 REQ-PIWD-001 要求：凡研究 F3EO 等核心优化器特性，必须先完全关闭 PIWD 做公平消融，后续再测协同。

## F3E-Warp（已删）

**假设**：用未归一化曲率 `–2Hg` 替代梯度下降，学习率锁 1.0，`meta_grad_clip_norm` 防发散。  
**结果**：缺 `∇Accuracy` 锚定，陷入“零梯度-随机准确率”死区；检查点 BUG 已修。  
**结论**：假设证伪，反向验证 `g – δ_meta` 缺一不可；代码移除，仅留文档警示。

## F3EL: F3EO with Loss-scaling

F3EL 用主损失 `L` 缩放三阶复杂度梯度 `δ_meta`（`g_eff = g − L·δ_meta`），试图在训练后期抑制过拟合。该思路已被 **F3EPI** 取代，后者以预测完整性 `PI` 为反馈信号，实现更精细的协同平衡。

## 数据处理流程的语义破坏

在 `wikitext-2` 任务的早期实现中，我们采用了将所有文章拼接成一个长序列再进行切块（`Concatenate and Chunk`）的数据处理策略。事实证明，这种方法在文章边界处制造了不符合语法的、破坏语义连贯性的人工序列连接。这种对训练数据的噪声注入，被证明是导致模型（特别是高效率的 F3EPI 优化器）过早进入过拟合状态的根本原因。正确的做法是应在每篇文章内部独立进行切块，以完全尊重其语义边界。该问题已在 `task/wikitext2.py` 中修复。
