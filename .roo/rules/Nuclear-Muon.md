# Nuclear-Muon: 核范数约束下的低秩优化器

**版本**: 1.0 (2025-11-20)
**作者**: Ω Researcher
**状态**: 理论设计完成，待实现与验证

## 摘要

Nuclear-Muon 是一款基于核范数（Nuclear Norm）正则化的二阶优化器，旨在超越 Muon 的谱范数约束，通过主动促进权重矩阵的低秩化，实现更深刻的模型简约性。本文将阐述其理论动机、核心机制、与 Muon 的本质区别，以及实现路径。

## 理论动机：从稳定到简约

Muon 优化器通过 Newton-Schulz 迭代强制权重矩阵的更新保持正交性，即约束奇异值 `σᵢ ≈ 1`。这种约束虽然有效防止了梯度爆炸/消失，但存在两个根本性问题：

1. **过度约束**：强制所有奇异值趋近于 1 是一种"暴力美学"，它阻止了模型主动"丢弃"不重要的信息维度。
2. **描述长度未最小化**：正交矩阵的秩等于其维度，无法实现对模型描述长度 `L(M)` 的主动压缩。

核范数正则化则提供了更优雅的解决方案：

`||W||_* = Σ σᵢ(W)`

核范数是秩函数的最佳凸近似，最小化核范数等价于在平滑地最小化矩阵的秩。这直接服务于 MDL 原则——**低秩 = 更短的描述长度**。

## 核范数的数学性质

### 定义与凸性

对于权重矩阵 `W ∈ ℝ^(m×n)`，其核范数定义为所有奇异值之和：

`||W||_* = Σᵢ₌₁ʳ σᵢ(W)`，其中 `r = rank(W)`

关键性质：
- **凸性**：核范数是凸函数，适合梯度优化
- **对偶性**：`||W||_* = max_{||X||₂ ≤ 1} ⟨W, X⟩`，其中 `||·||₂` 是谱范数
- **次梯度**：`∂||W||_* = U Vᵀ + {Z: UᵀZ = 0, ZV = 0, ||Z||₂ ≤ 1}`，其中 `W = UΣVᵀ` 是 SVD

### 与谱范数的关系

谱范数（Muon 的约束目标）是最大奇异值：`||W||₂ = σₘₐₓ(W)`

核范数与谱范数的关系：
- `||W||₂ ≤ ||W||_* ≤ rank(W) · ||W||₂`
- 对于正交矩阵：`||W||₂ = 1`，`||W||_* = rank(W)`

**核心洞察**：Muon 最小化 `||W||₂`，而 Nuclear-Muon 最小化 `||W||_*`。前者追求"稳定"，后者追求"简约"。

## 算法设计

### 算子复合框架

沿用 Hadron 的算子复合范式：

`g_update = Nuclear_Op( SGD_Op( Raw_Gradient ) )`

其中：
- `SGD_Op`: 标准的动量 SGD，计算原始梯度的一阶矩
- `Nuclear_Op`: 核范数约束算子，将梯度投影到低秩流形

### Nuclear_Op 的实现

核心挑战：高效计算核范数的次梯度。

**算法 1: 基于幂迭代的近似次梯度**

```python
def nuclear_gradient(W, k=5):
    """
    计算核范数的近似次梯度
    W: 权重矩阵 (m×n)
    k: 保留的顶部奇异向量数
    """
    # 1. 通过幂迭代计算顶部 k 个奇异向量
    U, sigma, Vt = power_iteration_svd(W, k=k)
    
    # 2. 次梯度近似: ∂||W||_* ≈ U Vᵀ
    # 对于不在顶部 k 的子空间，贡献被截断
    subgradient = U @ Vt
    
    return subgradient, sigma  # 返回次梯度和奇异值用于监控
```

**算法 2: 更新规则**

```python
def nuclear_muon_update(grad, momentum, W, beta=0.95, nuclear_strength=0.1):
    """
    Nuclear-Muon 更新规则
    """
    # 1. 动量累积 (SGD_Op)
    momentum.lerp_(grad, 1 - beta)
    
    # 2. 计算核范数次梯度 (Nuclear_Op)
    nuclear_grad, singular_values = nuclear_gradient(W)
    
    # 3. 复合更新: 梯度下降 + 核范数约束
    # 相当于在损失函数中隐式添加 λ·||W||_* 正则项
    update = momentum - nuclear_strength * nuclear_grad
    
    return update, singular_values
```

### 与 Muon 的本质区别

| 特性 | Muon | Nuclear-Muon |
| :--- | :--- | :--- |
| **约束目标** | `||W||₂ ≈ 1` (谱范数) | `||W||_*` 最小化 (核范数) |
| **几何意义** | Stiefel 流形上的优化 | 低秩流形上的优化 |
| **秩的影响** | 保持满秩 | 主动降低秩 |
| **MDL 契合度** | 间接稳定 | 直接压缩 |
| **计算成本** | Newton-Schulz 迭代 (O(d²)) | 幂迭代 SVD (O(k·d²)) |

## 实现路径

### 阶段 1: 基础实现

1. 实现 `optimizer/nuclear_muon.py`
2. 在 `optimizer/__init__.py` 中注册 "NuclearMuon"
3. 创建测试配置文件 `config/cifar10_nuclear_muon.toml`

### 阶段 2: 性能优化

1. 研究无矩阵 (Matrix-Free) 的幂迭代实现
2. 探索随机 SVD 加速
3. 实现奇异值谱的实时监控

### 阶段 3: 理论验证

1. 对比 Nuclear-Muon 与 Muon 的奇异值分布
2. 验证核范数约束是否加速 Grokking 现象
3. 分析在持续学习场景下的遗忘抑制能力

## 预期成果

我们预期 Nuclear-Muon 将展现出：

1. **更稀疏的谱分布**：大量奇异值趋近于 0，少数奇异值保持较大
2. **更强的泛化能力**：在过参数化模型上减少过拟合
3. **更快的 Grokking**：低秩约束可能加速"清理阶段"
4. **更好的可解释性**：顶部奇异向量对应学习到的核心特征子空间

---

**理论完备性检查**: 核范数作为凸正则项，满足 SOO-OFE 对 `L(M)` 的所有约束——数据无关、代数性、本征属性。它是 Muon 的谱范数约束的自然推广，从"稳定"走向"简约"。